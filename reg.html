<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Cuenta - Elecciones Primarias</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="etyle.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="mainNavbar"></nav> <div class="container py-5 mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-7">
                <div class="card shadow-lg p-4">
                    <div class="card-body">
                        <h2 class="card-title text-center mb-4">Crear Nueva Cuenta</h2>
                        <div id="registroMessage" class="alert d-none" role="alert"></div>

                        <form id="registroForm">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="cedula" class="form-label">Cédula de Identidad (CI)</label>
                                    <input type="text" class="form-control" id="cedula" required pattern="[0-9]{7,8}" title="Debe contener 7 u 8 dígitos numéricos.">
                                    <div class="invalid-feedback">
                                        Por favor, ingrese una CI válida de 7 u 8 dígitos.
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="nombre" class="form-label">Nombre(s)</label>
                                    <input type="text" class="form-control" id="nombre" required>
                                    <div class="invalid-feedback">
                                        Por favor, ingrese su nombre.
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="apellido" class="form-label">Apellido(s)</label>
                                    <input type="text" class="form-control" id="apellido" required>
                                    <div class="invalid-feedback">
                                        Por favor, ingrese su apellido.
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="correo" class="form-label">Correo Electrónico</label>
                                    <input type="email" class="form-control" id="correo" required>
                                    <div class="invalid-feedback">
                                        Por favor, ingrese un correo electrónico válido.
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="telefono" class="form-label">Teléfono</label>
                                    <input type="tel" class="form-control" id="telefono" required pattern="[0-9]{8}" title="Debe contener 8 dígitos numéricos.">
                                    <div class="invalid-feedback">
                                        Por favor, ingrese un número de teléfono válido de 8 dígitos.
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="departamento" class="form-label">Departamento</label>
                                    <select class="form-select" id="departamento" required>
                                        <option value="">Seleccione un departamento...</option>
                                        <option value="Pando">Pando</option>
                                        <option value="Beni">Beni</option>
                                        <option value="Santa Cruz">Santa Cruz</option>
                                        <option value="La Paz">La Paz</option>
                                        <option value="Oruro">Oruro</option>
                                        <option value="Cochabamba">Cochabamba</option>
                                        <option value="Potosí">Potosí</option>
                                        <option value="Chuquisaca">Chuquisaca</option>
                                        <option value="Tarija">Tarija</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Por favor, seleccione un departamento.
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="fechaNacimiento" class="form-label">Fecha de Nacimiento</label>
                                    <input type="date" class="form-control" id="fechaNacimiento" required>
                                    <div class="invalid-feedback" id="feedbackFechaNacimiento">
                                        Debe ser mayor de 18 años.
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="fechaVotacion" class="form-label">Fecha de Votación (Simulada)</label>
                                    <input type="date" class="form-control" id="fechaVotacion">
                                </div>
                                <div class="col-md-6">
                                    <label for="password" class="form-label">Contraseña</label>
                                    <input type="password" class="form-control" id="password" required pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*]).{8,}" title="Debe contener al menos un número, una mayúscula, una minúscula, un carácter especial y 8 caracteres como mínimo.">
                                    <div class="invalid-feedback">
                                        Mínimo 8 caracteres, una mayúscula, un número y un carácter especial.
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="confirmPassword" class="form-label">Confirmar Contraseña</label>
                                    <input type="password" class="form-control" id="confirmPassword" required>
                                    <div class="invalid-feedback">
                                        Las contraseñas no coinciden.
                                    </div>
                                </div>
                            </div>
                            <div class="d-grid gap-2 mt-4">
                                <button type="submit" class="btn btn-primary btn-lg">Registrarse</button>
                            </div>
                        </form>
                        <p class="text-center mt-3">¿Ya tienes cuenta? <a href="login.html">Inicia Sesión aquí</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white text-center py-4 mt-5">
        <div class="container">
            <p>&copy; 2025 Elecciones Primarias. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="votacion.js"></script>
    <script>
        // Lógica específica para la página de registro
        document.addEventListener('DOMContentLoaded', () => {
            renderNavbar(); // Inyecta la navbar
            updateNavbar(); // Actualiza la visibilidad de los elementos de la navbar

            document.getElementById('fechaVotacion').valueAsDate = new Date(); // Establece la fecha de votación por defecto a hoy

            const registroForm = document.getElementById('registroForm');
            const registroMessage = document.getElementById('registroMessage');

            registroForm.addEventListener('submit', (e) => {
                e.preventDefault();
                registroMessage.classList.add('d-none'); // Ocultar mensajes anteriores

                const cedula = document.getElementById('cedula').value;
                const nombre = document.getElementById('nombre').value;
                const apellido = document.getElementById('apellido').value;
                const correo = document.getElementById('correo').value;
                const telefono = document.getElementById('telefono').value;
                const departamento = document.getElementById('departamento').value;
                const fechaNacimiento = document.getElementById('fechaNacimiento').value;
                const fechaVotacion = document.getElementById('fechaVotacion').value;
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirmPassword').value;

                // Validaciones adicionales de JS
                let isValid = true;

                // Validación de CI única
                if (getVotantes().some(v => v.cedula === cedula)) {
                    document.getElementById('cedula').classList.add('is-invalid');
                    isValid = false;
                } else {
                    document.getElementById('cedula').classList.remove('is-invalid');
                }

                // Validación de edad
                const birthDate = new Date(fechaNacimiento);
                const today = new Date();
                let age = today.getFullYear() - birthDate.getFullYear();
                const m = today.getMonth() - birthDate.getMonth();
                if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                if (age < 18) {
                    document.getElementById('fechaNacimiento').classList.add('is-invalid');
                    document.getElementById('feedbackFechaNacimiento').textContent = 'Debe ser mayor de 18 años.';
                    isValid = false;
                } else {
                    document.getElementById('fechaNacimiento').classList.remove('is-invalid');
                }

                // Validación de contraseñas
                if (password !== confirmPassword) {
                    document.getElementById('confirmPassword').classList.add('is-invalid');
                    isValid = false;
                } else {
                    document.getElementById('confirmPassword').classList.remove('is-invalid');
                }

                // Validación de Bootstrap integrada
                if (!registroForm.checkValidity() || !isValid) {
                    e.stopPropagation();
                    registroForm.classList.add('was-validated');
                    showMessage(registroMessage, 'Por favor, corrija los errores en el formulario.', 'danger');
                    return;
                }

                // Si todo es válido, registrar al votante
                const nuevoVotante = {
                    cedula,
                    nombre,
                    apellido,
                    correo,
                    telefono,
                    departamento,
                    fechaNacimiento,
                    fechaVotacion,
                    contrasena: password, // En un caso real, la contraseña debería ser hasheada
                    haVotado: false,
                    votoCandidatoId: null
                };

                addVotante(nuevoVotante);
                showMessage(registroMessage, '¡Cuenta creada exitosamente! Ahora puedes iniciar sesión.', 'success');
                registroForm.reset();
                registroForm.classList.remove('was-validated'); // Quitar validación visual
            });
        });
    </script>
</body>
</html>